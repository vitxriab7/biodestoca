---
title: "Resultados"
---

## 游늳 An치lises e Gr치ficos por Enzima

```{r}
# Carregar pacotes necess치rios
library(tidyverse)
library(forcats)
library(emmeans)

# Carregar os dados previamente salvos pelo arquivo melhoresisolados.qmd
load("estatisticas_base.RData")

# Verificar as enzimas dispon칤veis
enzimas <- unique(dados$enzima)

# Dicion치rio de nomes completos das enzimas
nomes_enzimas <- c(
  bgli = "-glicosidase",
  xil = "Xilanase",
  endog = "Endoglucanase",
  lac = "Lacase",
  fpa = "FPase",
  bxil = "-xilosidase",
  mangper = "Mangan칡s Peroxidase"
)
```

------------------------------------------------------------------------

## 游빍 Gr치ficos de Atividade Enzim치tica

```{r}
# Loop para gerar um gr치fico por enzima
for (enz in enzimas) {
  
  subdados <- dados %>%
    filter(enzima == enz) %>%
    filter(!is.na(atividade), !is.nan(atividade), !is.infinite(atividade))
  
  if (nrow(subdados) < 3) next
  
  nome_completo <- nomes_enzimas[[tolower(enz)]]
  if (is.null(nome_completo)) nome_completo <- enz
  
  grafico <- subdados %>%
    group_by(isolado, substrato) %>%
    summarise(
      media = mean(atividade, na.rm = TRUE),
      .groups = "drop"
    ) %>%
    ggplot(aes(x = media, y = forcats::fct_rev(isolado), fill = substrato)) +
    geom_col() +
    labs(
      title = paste("Atividade da enzima:", nome_completo),
      x = "M칠dia da atividade (U/mL)",
      y = "Isolado",
      fill = "Substrato"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
      legend.position = "right"
    )
  
  print(grafico)
}
```

------------------------------------------------------------------------

## 游끥 Top 3 Isolados por Enzima

```{r}
library(tidyverse)
library(ggplot2)
library(forcats)
library(scales)

# Dicion치rio de nomes completos das enzimas
nomes_enzimas <- c(
  bgli = "-glicosidase",
  xil = "Xilanase",
  endog = "Endoglucanase",
  lac = "Lacase",
  fpa = "FPase",
  bxil = "-xilosidase",
  mangper = "Mangan칡s Peroxidase"
)

# Calcular top 3 isolados por enzima
melhores_isolados <- dados %>%
  group_by(enzima, isolado) %>%
  summarise(media_atividade = mean(atividade, na.rm = TRUE), .groups = "drop") %>%
  arrange(enzima, desc(media_atividade)) %>%
  group_by(enzima) %>%
  slice_head(n = 3) %>%
  mutate(colocacao = row_number())

# Novas cores do p칩dio (1췈, 2췈, 3췈)
cores_podio <- c("1" = "#1f78b4",  # Azul escuro
                 "2" = "#33a02c",  # Verde vibrante
                 "3" = "#ff7f00")  # Laranja forte

# Loop para gerar p칩dio por enzima com visual clean
for (enz in unique(melhores_isolados$enzima)) {
  
  dados_podio <- melhores_isolados %>% 
    filter(enzima == enz)
  
  # Obter o nome completo da enzima (confere min칰sculas)
  nome_completo <- nomes_enzimas[[tolower(enz)]]
  if (is.null(nome_completo)) nome_completo <- enz
  
  grafico_podio <- ggplot(dados_podio, 
                          aes(x = fct_reorder(isolado, -media_atividade), 
                              y = media_atividade, 
                              fill = factor(colocacao))) +
    geom_col(width = 0.6, 
             color = "white",   # Borda branca nas barras
             size = 0.7, 
             show.legend = FALSE) +
    geom_text(aes(label = round(media_atividade, 2)), 
              vjust = -0.5, 
              size = 4) +
    scale_fill_manual(values = cores_podio) +
    labs(
      title = paste("游끥 P칩dio: Top 3 isolados para", nome_completo),
      x = NULL,  # Removendo o r칩tulo do eixo x para maior limpeza
      y = "M칠dia da atividade enzim치tica"
    ) +
    theme_minimal(base_size = 14) +
    theme(
      plot.title = element_text(hjust = 0.5, 
                                face = "bold", 
                                margin = margin(b = 10)),
      axis.text.x = element_text(face = "bold"),
      panel.grid.minor = element_blank(),         # Remove gridlines menores
      panel.grid.major.x = element_blank(),         # Remove gridlines verticais
      axis.line = element_line(color = "black"),    # Linhas dos eixos para delimita칞칚o
      plot.margin = margin(15, 15, 15, 15)
    ) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.1)))  # D치 um espa칞o para os r칩tulos acima das barras
  
  print(grafico_podio)
}

```
